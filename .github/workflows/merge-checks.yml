name: "Merge checks"

on:
  push:
    branches: "main"

# only run this once per branch at a time
concurrency:
  group: ${{ github.workflow }}-${{ github.ref_name }}
  cancel-in-progress: true

jobs:
  integration-tests-dbt-athena:
    uses: ./.github/workflows/integration-tests.yml
    with:
      branch: ${{ github.ref }}
    secrets: inherit

  # integration test runs can't run in parallel for now, so run them in serial
  integration-tests-dbt-athena-community:
    needs: integration-tests-dbt-athena
    uses: ./.github/workflows/integration-tests.yml
    with:
      package: "dbt-athena-community"
      branch: ${{ github.ref }}
    secrets: inherit
